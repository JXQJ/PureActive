// ***********************************************************************
// Assembly         : PureActive.Hosting
// Author           : SteveBu
// Created          : 11-03-2018
// License          : Licensed under MIT License, see https://github.com/PureActive/PureActive/blob/master/LICENSE
//
// Last Modified By : SteveBu
// Last Modified On : 11-20-2018
// ***********************************************************************
// <copyright file="ConfigurationBuilderExtensions.cs" company="BushChang Corporation">
//     © 2018 BushChang Corporation. All rights reserved.
// </copyright>
// <summary></summary>
// ***********************************************************************
using System;
using System.Collections.Generic;
using Microsoft.AspNetCore.Hosting;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.Logging;
using PureActive.Core.System;
using PureActive.Logger.Provider.Serilog.Types;
using Serilog.Events;

namespace PureActive.Hosting.Configuration
{
    /// <summary>
    /// Class ConfigurationBuilderExtensions.
    /// </summary>
    /// <autogeneratedoc />
    public static class ConfigurationBuilderExtensions
    {
        /// <summary>
        /// Adds the application settings.
        /// </summary>
        /// <param name="config">The configuration.</param>
        /// <param name="environmentName">Name of the environment.</param>
        /// <returns>IConfigurationBuilder.</returns>
        /// <autogeneratedoc />
        public static IConfigurationBuilder AddAppSettings(this IConfigurationBuilder config, string environmentName)
        {
            var fileSystem = new FileSystem();
            var settingsDirectory = fileSystem.SettingsFolder;

            config
                .AddJsonFile(settingsDirectory + "sharedsettings.json", false, true)
                .AddJsonFile(settingsDirectory + "appsettings.json", false, true)
                .AddJsonFile(settingsDirectory + $"appsettings.{environmentName}.json", true, true);

            return config;
        }

        /// <summary>
        /// Adds the application settings.
        /// </summary>
        /// <param name="config">The configuration.</param>
        /// <param name="hostingEnvironment">The hosting environment.</param>
        /// <returns>IConfigurationBuilder.</returns>
        /// <autogeneratedoc />
        public static IConfigurationBuilder AddAppSettings(this IConfigurationBuilder config,
            IHostingEnvironment hostingEnvironment)
        {
            return AddAppSettings(config, hostingEnvironment.EnvironmentName);
        }

        /// <summary>
        /// Adds the application settings.
        /// </summary>
        /// <param name="config">The configuration.</param>
        /// <returns>IConfigurationBuilder.</returns>
        /// <autogeneratedoc />
        public static IConfigurationBuilder AddAppSettings(this IConfigurationBuilder config)
        {
            var environmentName = Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT");

            if (string.IsNullOrEmpty(environmentName))
                environmentName = EnvironmentName.Development;

            return AddAppSettings(config, environmentName);
        }

        //"Serilog": {
        //    "MinimumLevel": {
        //        "Default": "Debug",
        //        "Override": {
        //            "Microsoft": "Information",
        //            "System": "Warning"
        //        }
        //    }

        /// <summary>
        /// Adds the logger settings.
        /// </summary>
        /// <param name="config">The configuration.</param>
        /// <param name="initialMinimumLevel">The initial minimum level.</param>
        /// <returns>IConfigurationBuilder.</returns>
        /// <autogeneratedoc />
        public static IConfigurationBuilder AddLoggerSettings(this IConfigurationBuilder config,
            LogEventLevel initialMinimumLevel)
        {
            config.AddInMemoryCollection(
                new Dictionary<string, string>
                {
                    ["Serilog:MinimumLevel:Default"] = initialMinimumLevel.ToString(),
                    ["Serilog:MinimumLevel:Override:Microsoft"] = "Information",
                    ["Serilog:MinimumLevel:Override:System"] = "Warning"
                }
            );

            return config;
        }

        /// <summary>
        /// Adds the logger settings.
        /// </summary>
        /// <param name="config">The configuration.</param>
        /// <param name="initialMinimumLevel">The initial minimum level.</param>
        /// <returns>IConfigurationBuilder.</returns>
        /// <autogeneratedoc />
        public static IConfigurationBuilder AddLoggerSettings(this IConfigurationBuilder config,
            LogLevel initialMinimumLevel) =>
            AddLoggerSettings(config, SerilogLogLevel.MsftToSerilogLogLevel(initialMinimumLevel));
    }
}